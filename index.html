textarea { 
      width: 100%; 
      height: 150px; 
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      resize: vertical;
      transition: border-color 0.3s;
    }
    textarea:focus {
      outline: none;
      border-color: #667eea;
    }<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Name Extractor â€“ TruyenWikiDich</title>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      padding: 20px; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      min-height: 100vh;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      color: #4a5568;
      margin-bottom: 10px;
      font-size: 2.5em;
    }
    .subtitle {
      text-align: center;
      color: #718096;
      margin-bottom: 30px;
      font-style: italic;
    }
    .section {
      margin-bottom: 25px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
      border-left: 4px solid #667eea;
    }
    input[type="text"] { 
      width: 100%; 
      padding: 12px; 
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
    }
    textarea { 
      width: 100%; 
      height: 150px; 
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      resize: vertical;
      transition: border-color 0.3s;
    }
    textarea:focus {
      outline: none;
      border-color: #667eea;
    }
    button { 
      padding: 12px 24px; 
      margin: 10px 5px 10px 0; 
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover { 
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }
    button:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .status {
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
      font-weight: 500;
    }
    .status.success {
      background: #c6f6d5;
      color: #22543d;
      border: 1px solid #9ae6b4;
    }
    .status.error {
      background: #fed7d7;
      color: #742a2a;
      border: 1px solid #fc8181;
    }
    .status.info {
      background: #bee3f8;
      color: #2a4365;
      border: 1px solid #90cdf4;
    }
    .preview {
      background: #fff;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
      max-height: 200px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.4;
    }
    .count {
      font-weight: bold;
      color: #667eea;
    }
    .bookmarklet {
      background: #2d3748;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      word-break: break-all;
      margin-top: 10px;
    }
    .instruction {
      background: #fff5cd;
      border: 1px solid #f6e05e;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš€ Name Extractor</h1>
    <p class="subtitle">TrÃ­ch xuáº¥t vÃ  táº£i danh sÃ¡ch tÃªn nhÃ¢n váº­t tá»« TruyenWikiDich má»™t cÃ¡ch tá»± Ä‘á»™ng</p>

    <div class="instruction">
      <strong>ğŸ“ HÆ°á»›ng dáº«n sá»­ dá»¥ng:</strong>
      <ol>
        <li>Truy cáº­p trang Wiki cá»§a truyá»‡n</li>
        <li>Nháº¥n vÃ o nÃºt "TrÃ­ch xuáº¥t tá»« trang hiá»‡n táº¡i" khi Ä‘ang á»Ÿ trang Ä‘Ã³</li>
        <li>Hoáº·c nháº­p link trang Wiki vÃ o Ã´ bÃªn dÆ°á»›i</li>
        <li>File sáº½ Ä‘Æ°á»£c tá»± Ä‘á»™ng táº£i vá»!</li>
      </ol>
    </div>

    <div class="section">
      <h2>ğŸ¯ TrÃ­ch xuáº¥t tá»± Ä‘á»™ng</h2>
      <input id="linkInput" type="text" placeholder="Nháº­p link trang Wiki cá»§a truyá»‡n..." />
      <br>
      <button id="autoBtn">ğŸ“¥ TrÃ­ch xuáº¥t tá»« link</button>
      <button id="currentPageBtn">ğŸ” TrÃ­ch xuáº¥t tá»« trang hiá»‡n táº¡i</button>
    </div>



    <div class="section">
      <h2>ğŸ’¾ Káº¿t quáº£ vÃ  táº£i vá»</h2>
      <input id="fileName" type="text" placeholder="TÃªn file (tá»± Ä‘á»™ng táº¡o tá»« tiÃªu Ä‘á» trang)" />
      <br>
      <button id="downloadBtn" disabled>ğŸ“ Táº£i xuá»‘ng file TXT</button>
      <div id="status"></div>
      <div id="preview" class="preview" style="display: none;"></div>
    </div>

    <div class="section">
      <h2>ğŸ”– Bookmarklet (DÃ nh cho cao thá»§)</h2>
      <p>KÃ©o tháº£ link nÃ y vÃ o thanh bookmark Ä‘á»ƒ sá»­ dá»¥ng trÃªn báº¥t ká»³ trang nÃ o:</p>
      <div class="bookmarklet">
        <a href="javascript:(()=>{try{let m=document.getElementById('mdListName');if(!m)return alert('âŒ KhÃ´ng tháº¥y ná»™i dung.');let l=m.innerText.split('\n').map(x=>x.trim()).filter(x=>x.includes('=')&&!/(tá»•ng sá»‘|lá»‹ch sá»­|Ä‘Ã³ng)/i.test(x));if(!l.length)return alert('âŒ KhÃ´ng cÃ³ dÃ²ng há»£p lá»‡.');let t=document.title.replace(/[\\/:*?\"<>|]+/g,'_'),f=`name2_${t}.txt`,b=new Blob([l.join('\n')],{type:'text/plain'}),u=URL.createObjectURL(b),a=document.createElement('a');a.href=u;a.download=f;document.body.appendChild(a);a.click();a.remove()}catch(e){alert('âŒ Lá»—i: '+e.message),console.error(e)}})()">
          ğŸ“š Name Extractor Bookmarklet
        </a>
      </div>
    </div>
  </div>

  <script>
    let extractedNames = [];
    let currentFileName = '';

    function showStatus(message, type = 'info') {
      const statusDiv = document.getElementById('status');
      statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
      setTimeout(() => {
        if (type !== 'success') statusDiv.innerHTML = '';
      }, 5000);
    }

    function extractNamesFromWikiContent(content) {
      // TÃ¬m element cÃ³ id="mdListName" trong HTML
      const parser = new DOMParser();
      const doc = parser.parseFromString(content, 'text/html');
      const mdListName = doc.getElementById('mdListName');
      
      if (!mdListName) {
        throw new Error('KhÃ´ng tÃ¬m tháº¥y element #mdListName trong trang');
      }

      // Láº¥y text content vÃ  xá»­ lÃ½ giá»‘ng nhÆ° bookmarklet
      const lines = mdListName.innerText
        .split('\n')
        .map(x => x.trim())
        .filter(x => x.includes('=') && !/(tá»•ng sá»‘|lá»‹ch sá»­|Ä‘Ã³ng)/i.test(x));

      if (!lines.length) {
        throw new Error('KhÃ´ng cÃ³ dÃ²ng há»£p lá»‡ nÃ o Ä‘Æ°á»£c tÃ¬m tháº¥y');
      }

      return lines;
    }



    function generateFileName(title = '') {
      const cleanTitle = title || document.title || 'TruyenWiki';
      return `name2_${cleanTitle.replace(/[\\/:*?"<>|]+/g, '_')}.txt`;
    }

    function updatePreview(names) {
      const preview = document.getElementById('preview');
      const downloadBtn = document.getElementById('downloadBtn');
      
      if (names.length > 0) {
        preview.style.display = 'block';
        preview.innerHTML = `<strong class="count">TÃ¬m tháº¥y ${names.length} tÃªn:</strong><br><br>` + 
                           names.slice(0, 20).join('<br>') + 
                           (names.length > 20 ? '<br><br>... vÃ  ' + (names.length - 20) + ' tÃªn khÃ¡c' : '');
        downloadBtn.disabled = false;
        extractedNames = names;
        showStatus(`âœ… TrÃ­ch xuáº¥t thÃ nh cÃ´ng ${names.length} tÃªn!`, 'success');
      } else {
        preview.style.display = 'none';
        downloadBtn.disabled = true;
        extractedNames = [];
        showStatus('âŒ KhÃ´ng tÃ¬m tháº¥y tÃªn nÃ o!', 'error');
      }
    }

    function downloadFile(filename, content) {
      const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // TrÃ­ch xuáº¥t tá»« link
    document.getElementById('autoBtn').addEventListener('click', async () => {
      const link = document.getElementById('linkInput').value.trim();
      if (!link) {
        showStatus('âŒ Vui lÃ²ng nháº­p link trang truyá»‡n!', 'error');
        return;
      }

      showStatus('ğŸ”„ Äang táº£i trang...', 'info');
      
      try {
        // Sá»­ dá»¥ng proxy Ä‘á»ƒ trÃ¡nh CORS (cÃ³ thá»ƒ cáº§n thay Ä‘á»•i tÃ¹y theo mÃ´i trÆ°á»ng)
        const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(link)}`;
        const response = await fetch(proxyUrl);
        const data = await response.json();
        
        if (!data.contents) {
          throw new Error('KhÃ´ng thá»ƒ táº£i ná»™i dung trang');
        }

        const names = extractNamesFromWikiContent(data.contents);
        
        // Táº¡o tÃªn file tá»« tiÃªu Ä‘á» trang
        const parser = new DOMParser();
        const doc = parser.parseFromString(data.contents, 'text/html');
        const title = doc.title || 'TruyenWiki';
        currentFileName = generateFileName(title);
        document.getElementById('fileName').value = currentFileName;
        
        updatePreview(names);
        
      } catch (error) {
        console.error('Error:', error);
        showStatus(`âŒ Lá»—i: ${error.message}`, 'error');
      }
    });

    // TrÃ­ch xuáº¥t tá»« trang hiá»‡n táº¡i
    document.getElementById('currentPageBtn').addEventListener('click', () => {
      try {
        const mdListName = document.getElementById('mdListName');
        if (!mdListName) {
          // Náº¿u khÃ´ng cÃ³ element nÃ y, cÃ³ thá»ƒ Ä‘ang cháº¡y trÃªn trang khÃ¡c
          showStatus('âŒ KhÃ´ng tÃ¬m tháº¥y dá»¯ liá»‡u tÃªn trÃªn trang nÃ y. HÃ£y thá»­ sá»­ dá»¥ng bookmarklet hoáº·c nháº­p link.', 'error');
          return;
        }

        const lines = mdListName.innerText
          .split('\n')
          .map(x => x.trim())
          .filter(x => x.includes('=') && !/(tá»•ng sá»‘|lá»‹ch sá»­|Ä‘Ã³ng)/i.test(x));

        if (!lines.length) {
          throw new Error('KhÃ´ng cÃ³ dÃ²ng há»£p lá»‡ nÃ o Ä‘Æ°á»£c tÃ¬m tháº¥y');
        }

        currentFileName = generateFileName(document.title);
        document.getElementById('fileName').value = currentFileName;
        
        updatePreview(lines);
        
        // Tá»± Ä‘á»™ng táº£i xuá»‘ng
        setTimeout(() => {
          downloadFile(currentFileName, lines.join('\n'));
          showStatus('ğŸ‰ File Ä‘Ã£ Ä‘Æ°á»£c táº£i xuá»‘ng tá»± Ä‘á»™ng!', 'success');
        }, 1000);
        
      } catch (error) {
        console.error('Error:', error);
        showStatus(`âŒ Lá»—i: ${error.message}`, 'error');
      }
    });



    // Táº£i xuá»‘ng file
    document.getElementById('downloadBtn').addEventListener('click', () => {
      if (extractedNames.length === 0) {
        showStatus('âŒ KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘á»ƒ táº£i xuá»‘ng!', 'error');
        return;
      }

      let filename = document.getElementById('fileName').value.trim();
      if (!filename) {
        filename = currentFileName || 'names.txt';
      } else if (!filename.endsWith('.txt')) {
        filename += '.txt';
      }

      downloadFile(filename, extractedNames.join('\n'));
      showStatus(`ğŸ‰ ÄÃ£ táº£i xuá»‘ng file "${filename}" vá»›i ${extractedNames.length} tÃªn!`, 'success');
    });

    // Tá»± Ä‘á»™ng focus vÃ o input Ä‘áº§u tiÃªn
    document.getElementById('linkInput').focus();
  </script>
</body>
</html>
