<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng c·ª• s·ª≠a l·ªói encoding vƒÉn b·∫£n</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }
        
        textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .buttons {
            text-align: center;
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .clear-btn {
            background: linear-gradient(45deg, #e53e3e, #c53030);
        }
        
        .copy-btn {
            background: linear-gradient(45deg, #38a169, #2f855a);
        }
        
        .status {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-weight: 600;
        }
        
        .success {
            background: #c6f6d5;
            color: #2f855a;
            border: 1px solid #9ae6b4;
        }
        
        .info {
            background: #bee3f8;
            color: #2b6cb0;
            border: 1px solid #90cdf4;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß C√¥ng c·ª• s·ª≠a l·ªói encoding vƒÉn b·∫£n</h1>
        
        <div class="input-group">
            <label for="input">Nh·∫≠p vƒÉn b·∫£n c·∫ßn s·ª≠a:</label>
            <textarea id="input" placeholder="D√°n vƒÉn b·∫£n c√≥ l·ªói encoding v√†o ƒë√¢y..."></textarea>
        </div>
        
        <div class="buttons">
            <button onclick="fixText()">üîß S·ª≠a l·ªói encoding</button>
            <button onclick="clearText()" class="clear-btn">üóëÔ∏è X√≥a</button>
            <button onclick="copyResult()" class="copy-btn">üìã Copy k·∫øt qu·∫£</button>
        </div>
        
        <div class="input-group">
            <label for="output">K·∫øt qu·∫£ sau khi s·ª≠a:</label>
            <textarea id="output" readonly placeholder="K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y..."></textarea>
        </div>
        
        <div id="status"></div>
        
        <div id="changes-log" style="display: none;">
            <div class="input-group">
                <label>üìã Chi ti·∫øt thay ƒë·ªïi:</label>
                <div id="changes-content" style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 14px;"></div>
            </div>
        </div>
    </div>

    <script>
        // B·∫£n ƒë·ªì c√°c k√Ω t·ª± b·ªã l·ªói encoding - ch·ªâ nh·ªØng k√Ω t·ª± tr√¥ng gi·ªëng ch·ªØ g·ªëc
        const charMap = {
            // C√°c k√Ω t·ª± ph·ªï bi·∫øn b·ªã l·ªói encoding
            '‚ºâ': 'ÂÑø',  // con
            '‚ªù': 'È£ü',  // th·ª©c ƒÉn
            '‚º¶': 'Â≠ê',  // con trai  
            '‚ªî': 'Èó®',  // c·ª≠a
            '‚Ω§': 'Áî®',  // d√πng
            '‚ΩÖ': 'Êñπ',  // ph∆∞∆°ng
            '‚ºú': 'Âèà',  // l·∫°i
            '‚ºÄ': '‰∏Ä',  // m·ªôt
            '‚ºó': 'ÂçÅ',  // m∆∞·ªùi
            '‚º§': 'Â§ß',  // l·ªõn
            '‚ºà': '‰∫∫',  // ng∆∞·ªùi
            '‚ºä': 'ÂÖ•',  // v√†o
            '‚ºã': 'ÂÖ´',  // t√°m
            '‚ºí': 'Âäõ',  // s·ª©c m·∫°nh
            '‚ºë': 'ÂàÄ',  // dao
            '‚º•': 'Â•≥',  // n·ªØ
            '‚º©': 'Â∞è',  // nh·ªè
            '‚ºØ': 'Â∑•',  // c√¥ng
            '‚º∞': 'Â∑±',  // b·∫£n th√¢n
            '‚º±': 'Â∑æ',  // khƒÉn
            '‚º≤': 'Âπ≤',  // kh√¥
            '‚º¥': 'Âπø',  // r·ªông
            '‚º∏': 'Âºì',  // cung
            '‚ºº': 'ÂøÉ',  // tim
            '‚ºø': 'Êâã',  // tay
            '‚ΩÄ': 'ÊîØ',  // chi nh√°nh
            '‚ΩÇ': 'Êñá',  // vƒÉn
            '‚Ωá': 'Êó•',  // ng√†y
            '‚Ωâ': 'Êúà',  // th√°ng
            '‚Ωä': 'Êú®',  // g·ªó
            '‚Ωî': 'Ê∞¥',  // n∆∞·ªõc
            '‚Ωï': 'ÁÅ´',  // l·ª≠a
            '‚Ωó': 'Áà∂',  // cha
            '‚Ωö': 'Áâá',  // m·∫£nh
            '‚Ωõ': 'Áâô',  // rƒÉng
            '‚Ωú': 'Áâõ',  // b√≤
            '‚Ωù': 'Áä¨',  // ch√≥
            '‚Ωü': 'Áéâ',  // ng·ªçc
            '‚Ω°': 'Áì¶',  // ng√≥i
            '‚Ω¢': 'Áîò',  // ng·ªçt
            '‚Ω£': 'Áîü',  // sinh
            '‚Ω•': 'Áî∞',  // ru·ªông
            '‚Ω©': 'ÁôΩ',  // tr·∫Øng
            '‚Ω™': 'ÁöÆ',  // da
            '‚Ω´': 'Áöø',  // ƒëƒ©a
            '‚Ω¨': 'ÁõÆ',  // m·∫Øt
            '‚ΩØ': 'Áü≥',  // ƒë√°
            '‚Ω∞': 'Á§∫',  // ch·ªâ
            '‚Ω≤': 'Á¶æ',  // l√∫a
            '‚Ω≥': 'Á©¥',  // l·ªó
            '‚Ω¥': 'Á´ã',  // ƒë·ª©ng
            '‚Ωµ': 'Á´π',  // tre
            '‚Ω∂': 'Á±≥',  // g·∫°o
            '‚Ω∑': 'Á≥∏',  // t∆°
            '‚Ωπ': 'ÁΩë',  // m·∫°ng
            '‚Ω∫': 'Áæä',  // c·ª´u
            '‚Ωª': 'ÁæΩ',  // l√¥ng
            '‚Ωº': 'ËÄÅ',  // gi√†
            '‚ΩΩ': 'ËÄå',  // m√†
            '‚Ωø': 'ËÄ≥',  // tai
            '‚æÅ': 'ËÇâ',  // th·ªãt
            '‚æÇ': 'Ëá£',  // th·∫ßn
            '‚æÉ': 'Ëá™',  // t·ª±
            '‚æÑ': 'Ëá≥',  // ƒë·∫øn
            '‚æÜ': 'Ëàå',  // l∆∞·ª°i
            '‚æà': 'Ëàü',  // thuy·ªÅn
            '‚æä': 'Ëâ≤',  // m√†u
            '‚æç': 'Ëô´',  // c√¥n tr√∫ng
            '‚æé': 'Ë°Ä',  // m√°u
            '‚æè': 'Ë°å',  // h√†nh
            '‚æê': 'Ë°£',  // qu·∫ßn √°o
            '‚æì': 'Ëßí',  // g√≥c
            '‚æî': 'Ë®Ä',  // n√≥i
            '‚æï': 'Ë∞∑',  // thung l≈©ng
            '‚æñ': 'Ë±Ü',  // ƒë·∫≠u
            '‚æô': 'Ë¥ù',  // v·ªè s√≤
            '‚æö': 'Ëµ§',  // ƒë·ªè
            '‚æõ': 'Ëµ∞',  // ch·∫°y
            '‚æú': 'Ë∂≥',  // ch√¢n
            '‚æù': 'Ë∫´',  // th√¢n
            '‚æû': 'ËΩ¶',  // xe
            '‚æü': 'Ëæõ',  // cay
            '‚æ®': 'Èó®',  // c·ª≠a
            '‚æ¶': 'Èáë',  // v√†ng
            '‚æß': 'Èïø',  // d√†i
            '‚æ¨': 'Èõ®',  // m∆∞a
            '‚æÆ': 'Èùû',  // phi
            '‚æØ': 'Èù¢',  // m·∫∑t
            '‚æ∑': 'È£ü',  // ƒÉn
            '‚æ∏': 'È¶ñ',  // ƒë·∫ßu
            '‚æπ': 'È¶ô',  // th∆°m
            '‚æª': 'È™®',  // x∆∞∆°ng
            '‚æº': 'È´ò',  // cao
            '‚æ•': 'Èáå',  // trong/d·∫∑m
            '‚ΩÜ': 'Êó†',  // kh√¥ng c√≥
            '‚ª¢': 'È©¨',  // m√£
            '‚ªÖ': 'ËßÅ',  // th·∫•y
            '‚ªÜ': 'Ëßí',  // g√≥c
            '‚ª©': 'ÈªÑ',   // v√†ng (simplified)
        };
        
        function fixText() {
            const input = document.getElementById('input').value;
            const output = document.getElementById('output');
            const status = document.getElementById('status');
            const changesLog = document.getElementById('changes-log');
            const changesContent = document.getElementById('changes-content');
            
            if (!input.trim()) {
                showStatus('Vui l√≤ng nh·∫≠p vƒÉn b·∫£n c·∫ßn s·ª≠a!', 'info');
                changesLog.style.display = 'none';
                return;
            }
            
            let fixedText = input;
            let changesCount = 0;
            let changesList = [];
            
            // B∆Ø·ªöC 1: X√≥a k√Ω t·ª± th·ª´a theo regex (s·∫Ω hi·ªÉn th·ªã ·ªü ƒë·∫ßu)
            const removeRegex = /[Tt≈§≈•·π™·π´·π¨·π≠·πÆ·πØ·π∞·π±≈¢≈£·∫ó≈¶≈ß∆≠∆¨»ö»õ≈§≈•·π¨·π≠·π∞·π±][Uu√ö√∫√ô√π√õ√ª√ú√º≈®≈©≈™≈´≈¨≈≠≈Æ≈Ø≈≤≈≥·ª§·ª•·ª¶·ªß·π≤·π≥·π¥·πµ·π∂·π∑·π∏·ππ·π∫·πª≈∞≈±≈Æ≈Ø≈´ÃÅ≈≠≈≥][\u0300-\u036F]*[\u2070-\u209F‚ÇÄ-‚Çâ‚Çê‚Çë‚Çï·µ¢‚±º‚Çñ‚Çó‚Çò‚Çô‚Çí‚Çö·µ£‚Çõ‚Çú·µ§·µ•w‚Çì·µß·∂ª‚Å∞-‚Åπ¬π¬≤¬≥‚Å¥‚Åµ‚Å∂‚Å∑‚Å∏‚Åπ·µÉ-·∂ª‚Å∫‚Åª‚Åº‚ÅΩ‚Åæ‚Çä‚Çã‚Çå‚Çç‚Çé]+/g;
            
            let match;
            let removedCount = 0;
            
            // T√¨m v√† ghi l·∫°i t·∫•t c·∫£ k√Ω t·ª± th·ª´a tr∆∞·ªõc khi x√≥a
            while ((match = removeRegex.exec(input)) !== null) {
                removedCount++;
                
                // T√≠nh v·ªã tr√≠
                const beforeMatch = input.substring(0, match.index);
                const lineNumber = beforeMatch.split('\n').length;
                const lineStart = beforeMatch.lastIndexOf('\n') + 1;
                const columnNumber = match.index - lineStart + 1;
                
                // Context
                const start = Math.max(0, match.index - 5);
                const end = Math.min(input.length, match.index + match[0].length + 5);
                const context = input.substring(start, end);
                const contextHighlighted = context.replace(match[0], `<mark style="background: #ff5722; color: white; font-weight: bold;">${match[0]}</mark>`);
                
                changesList.push({
                    type: 'remove',
                    broken: match[0],
                    correct: '[X√ìA]',
                    line: lineNumber,
                    column: columnNumber,
                    context: contextHighlighted,
                    position: match.index
                });
                
                removeRegex.lastIndex = match.index + 1;
            }
            
            // Th·ª±c hi·ªán x√≥a k√Ω t·ª± th·ª´a
            fixedText = fixedText.replace(/[Tt≈§≈•·π™·π´·π¨·π≠·πÆ·πØ·π∞·π±≈¢≈£·∫ó≈¶≈ß∆≠∆¨»ö»õ≈§≈•·π¨·π≠·π∞·π±][Uu√ö√∫√ô√π√õ√ª√ú√º≈®≈©≈™≈´≈¨≈≠≈Æ≈Ø≈≤≈≥·ª§·ª•·ª¶·ªß·π≤·π≥·π¥·πµ·π∂·π∑·π∏·ππ·π∫·πª≈∞≈±≈Æ≈Ø≈´ÃÅ≈≠≈≥][\u0300-\u036F]*[\u2070-\u209F‚ÇÄ-‚Çâ‚Çê‚Çë‚Çï·µ¢‚±º‚Çñ‚Çó‚Çò‚Çô‚Çí‚Çö·µ£‚Çõ‚Çú·µ§·µ•w‚Çì·µß·∂ª‚Å∞-‚Åπ¬π¬≤¬≥‚Å¥‚Åµ‚Å∂‚Å∑‚Å∏‚Åπ·µÉ-·∂ª‚Å∫‚Åª‚Åº‚ÅΩ‚Åæ‚Çä‚Çã‚Çå‚Çç‚Çé]+/g, '');
            changesCount += removedCount;
            
            // B∆Ø·ªöC 2: Thay th·∫ø c√°c k√Ω t·ª± b·ªã l·ªói encoding
            for (const [broken, correct] of Object.entries(charMap)) {
                const regex = new RegExp(broken, 'g');
                let matchChar;
                
                // T√¨m trong vƒÉn b·∫£n ƒë√£ x√≥a k√Ω t·ª± th·ª´a
                while ((matchChar = regex.exec(fixedText)) !== null) {
                    changesCount++;
                    
                    // T√≠nh v·ªã tr√≠ (c·∫ßn t√≠nh l·∫°i do ƒë√£ x√≥a k√Ω t·ª± th·ª´a)
                    const beforeMatch = fixedText.substring(0, matchChar.index);
                    const lineNumber = beforeMatch.split('\n').length;
                    const lineStart = beforeMatch.lastIndexOf('\n') + 1;
                    const columnNumber = matchChar.index - lineStart + 1;
                    
                    // Context trong vƒÉn b·∫£n ƒë√£ x√≥a k√Ω t·ª± th·ª´a
                    const start = Math.max(0, matchChar.index - 5);
                    const end = Math.min(fixedText.length, matchChar.index + 6);
                    const context = fixedText.substring(start, end);
                    const contextHighlighted = context.replace(broken, `<mark style="background: #ffeb3b; color: #d32f2f; font-weight: bold;">${broken}</mark>`);
                    
                    changesList.push({
                        type: 'replace',
                        broken: broken,
                        correct: correct,
                        line: lineNumber,
                        column: columnNumber,
                        context: contextHighlighted,
                        position: matchChar.index
                    });
                    
                    regex.lastIndex = matchChar.index + 1;
                }
                
                // Th·ª±c hi·ªán thay th·∫ø
                fixedText = fixedText.replace(new RegExp(broken, 'g'), correct);
            }
            
            output.value = fixedText;
            
            if (changesCount > 0) {
                // S·∫Øp x·∫øp: k√Ω t·ª± b·ªã x√≥a tr∆∞·ªõc, k√Ω t·ª± thay th·∫ø sau
                changesList.sort((a, b) => {
                    if (a.type !== b.type) {
                        return a.type === 'remove' ? -1 : 1;
                    }
                    return a.position - b.position;
                });
                
                // Hi·ªÉn th·ªã chi ti·∫øt thay ƒë·ªïi
                let changesHtml = `<div style="margin-bottom: 10px;"><strong>üîÑ T·ªïng c·ªông: ${changesCount} thay ƒë·ªïi (${removedCount} x√≥a, ${changesCount - removedCount} thay th·∫ø)</strong></div>`;
                
                changesList.forEach((change, index) => {
                    const isRemove = change.type === 'remove';
                    const bgColor = isRemove ? '#ffebee' : '#e3f2fd';
                    const borderColor = isRemove ? '#f44336' : '#667eea';
                    const actionIcon = isRemove ? 'üóëÔ∏è' : 'üîÑ';
                    
                    changesHtml += `
                        <div style="border-left: 3px solid ${borderColor}; padding-left: 10px; margin-bottom: 10px; background: ${bgColor}; border-radius: 0 5px 5px 0;">
                            <div style="color: #666; font-size: 12px; margin-bottom: 5px;">
                                ${actionIcon} #${index + 1} ‚Ä¢ D√≤ng ${change.line}, c·ªôt ${change.column} ‚Ä¢ V·ªã tr√≠ ${change.position}
                            </div>
                            <div style="margin-bottom: 5px;">
                                <span style="color: ${isRemove ? '#d32f2f' : '#d32f2f'}; background: ${isRemove ? '#ffcdd2' : '#ffebee'}; padding: 2px 6px; border-radius: 3px; font-weight: bold;">${change.broken}</span>
                                <span style="margin: 0 8px; color: #666;">‚Üí</span>
                                <span style="color: ${isRemove ? '#d32f2f' : '#2e7d32'}; background: ${isRemove ? '#ffcdd2' : '#e8f5e8'}; padding: 2px 6px; border-radius: 3px; font-weight: bold;">${change.correct}</span>
                            </div>
                            <div style="color: #555; font-size: 13px;">
                                <strong>Context:</strong> ${change.context}
                            </div>
                        </div>
                    `;
                });
                
                changesContent.innerHTML = changesHtml;
                changesLog.style.display = 'block';
                
                showStatus(`‚úÖ ƒê√£ x·ª≠ l√Ω ${changesCount} thay ƒë·ªïi (${removedCount} x√≥a k√Ω t·ª± th·ª´a, ${changesCount - removedCount} s·ª≠a encoding)!`, 'success');
            } else {
                changesLog.style.display = 'none';
                showStatus('‚ÑπÔ∏è Kh√¥ng t√¨m th·∫•y k√Ω t·ª± n√†o c·∫ßn s·ª≠a.', 'info');
            }
        }
        
        function clearText() {
            document.getElementById('input').value = '';
            document.getElementById('output').value = '';
            document.getElementById('status').innerHTML = '';
            document.getElementById('changes-log').style.display = 'none';
        }
        
        function copyResult() {
            const output = document.getElementById('output');
            if (!output.value.trim()) {
                showStatus('Kh√¥ng c√≥ n·ªôi dung ƒë·ªÉ copy!', 'info');
                return;
            }
            
            output.select();
            output.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                showStatus('üìã ƒê√£ copy k·∫øt qu·∫£ v√†o clipboard!', 'success');
            } catch (err) {
                // Fallback cho c√°c tr√¨nh duy·ªát hi·ªán ƒë·∫°i
                navigator.clipboard.writeText(output.value).then(() => {
                    showStatus('üìã ƒê√£ copy k·∫øt qu·∫£ v√†o clipboard!', 'success');
                }).catch(() => {
                    showStatus('‚ùå Kh√¥ng th·ªÉ copy. Vui l√≤ng copy th·ªß c√¥ng.', 'info');
                });
            }
        }
        
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.innerHTML = message;
            status.className = `status ${type}`;
            
            // T·ª± ƒë·ªông ·∫©n sau 3 gi√¢y
            setTimeout(() => {
                status.innerHTML = '';
                status.className = '';
            }, 3000);
        }
        
        // T·ª± ƒë·ªông s·ª≠a khi ng∆∞·ªùi d√πng nh·∫≠p
        document.getElementById('input').addEventListener('input', function() {
            // Debounce ƒë·ªÉ tr√°nh x·ª≠ l√Ω qu√° nhi·ªÅu
            clearTimeout(this.timeout);
            this.timeout = setTimeout(() => {
                if (this.value.trim()) {
                    fixText();
                }
            }, 500);
        });
    </script>
</body>
</html>
